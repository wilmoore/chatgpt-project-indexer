openapi: 3.0.3
info:
  title: ChatGPT Project Indexer API
  description: |
    REST API for the ChatGPT Project Indexer.

    This API provides access to indexed ChatGPT projects and allows triggering
    "touch" operations to float projects to the top of the ChatGPT sidebar.

    ## Authentication

    For local development, no authentication is required.
    All endpoints accept the Supabase anon key via the `apikey` header.

    ## Base URLs

    - **Local Supabase:** `http://127.0.0.1:54321`
    - **PostgREST (data):** `http://127.0.0.1:54321/rest/v1`
    - **Edge Functions:** `http://127.0.0.1:54321/functions/v1`

    ## Touch Operations

    The touch queue allows external clients (like Raycast) to request that a
    project be "touched" to float it to the top of the ChatGPT sidebar.

    Touch requests are processed asynchronously by the indexer's watch mode,
    typically within 5-10 seconds.
  version: 1.0.0
  contact:
    name: ChatGPT Project Indexer
    url: https://github.com/wilmoore/chatgpt-project-indexer
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://127.0.0.1:54321
    description: Local Supabase instance

tags:
  - name: Projects
    description: Project data operations
  - name: Touch
    description: Touch queue operations
  - name: Meta
    description: Index metadata

paths:
  /rest/v1/projects:
    get:
      tags:
        - Projects
      summary: List all projects
      description: |
        Returns all indexed ChatGPT projects.

        Results are sorted alphabetically by title by default.
        Use query parameters to filter and paginate.
      operationId: listProjects
      parameters:
        - name: select
          in: query
          description: Columns to return (PostgREST column selection)
          schema:
            type: string
            default: "*"
          example: "id,title,first_seen_at"
        - name: order
          in: query
          description: Sort order (PostgREST ordering)
          schema:
            type: string
          example: "title.asc"
        - name: limit
          in: query
          description: Maximum number of results
          schema:
            type: integer
            minimum: 1
            maximum: 1000
          example: 100
        - name: offset
          in: query
          description: Number of results to skip
          schema:
            type: integer
            minimum: 0
          example: 0
      responses:
        "200":
          description: List of projects
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Project"
              example:
                - id: "g-p-abc123"
                  title: "My Project"
                  first_seen_at: "2026-01-15T10:00:00Z"
                  last_confirmed_at: "2026-01-15T16:00:00Z"
                  pinned: false
                  pinned_at: null
        "401":
          $ref: "#/components/responses/Unauthorized"

  /rest/v1/projects?id=eq.{projectId}:
    get:
      tags:
        - Projects
      summary: Get a single project
      description: Returns a single project by ID
      operationId: getProject
      parameters:
        - name: projectId
          in: path
          required: true
          description: Project ID (e.g., g-p-abc123)
          schema:
            type: string
          example: "g-p-abc123"
      responses:
        "200":
          description: Project details
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Project"
        "404":
          description: Project not found
          content:
            application/json:
              schema:
                type: array
                items: {}
                maxItems: 0

  /rest/v1/touch_queue:
    get:
      tags:
        - Touch
      summary: List touch queue requests
      description: |
        Returns touch queue requests.
        Use `project_id=eq.{id}` to check status of a specific request.
      operationId: listTouchQueue
      parameters:
        - name: project_id
          in: query
          description: Filter by project ID (PostgREST filter)
          schema:
            type: string
          example: "eq.g-p-abc123"
        - name: status
          in: query
          description: Filter by status (PostgREST filter)
          schema:
            type: string
          example: "eq.pending"
        - name: order
          in: query
          description: Sort order
          schema:
            type: string
            default: "created_at.desc"
      responses:
        "200":
          description: List of touch requests
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TouchRequest"

    post:
      tags:
        - Touch
      summary: Queue a touch request
      description: |
        Queues a request to touch a project, floating it to the top of the
        ChatGPT sidebar.

        The request is processed asynchronously by the indexer's watch mode.
        Typically processed within 5-10 seconds.

        **Raycast Integration Example:**
        ```typescript
        await fetch('http://127.0.0.1:54321/rest/v1/touch_queue', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'apikey': 'your-anon-key',
            'Prefer': 'return=representation'
          },
          body: JSON.stringify({ project_id: 'g-p-abc123' })
        });
        ```
      operationId: createTouchRequest
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - project_id
              properties:
                project_id:
                  type: string
                  description: ID of the project to touch
                  example: "g-p-abc123"
      responses:
        "201":
          description: Touch request created
          headers:
            Prefer:
              description: Set to "return=representation" to get the created record
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TouchRequest"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /functions/v1/meta:
    get:
      tags:
        - Meta
      summary: Get index metadata
      description: Returns metadata about the project index
      operationId: getMeta
      responses:
        "200":
          description: Index metadata
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Meta"
              example:
                name: "ChatGPT Project Index"
                version: "1.0.0"
                project_count: 473

  /functions/v1/projects:
    get:
      tags:
        - Projects
      summary: List projects (simplified)
      description: |
        Returns a simplified list of projects with just the essential fields.
        Useful for quick lookups and search interfaces.
      operationId: listProjectsSimplified
      responses:
        "200":
          description: Simplified project list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProjectSimplified"
              example:
                - id: "g-p-abc123"
                  name: "My Project"
                  open_url: "https://chatgpt.com/g/g-p-abc123/project"

components:
  schemas:
    Project:
      type: object
      description: A ChatGPT project
      properties:
        id:
          type: string
          description: Project identifier (e.g., g-p-abc123)
          example: "g-p-abc123"
        title:
          type: string
          description: Full project title
          example: "My Awesome Project"
        url:
          type: string
          format: uri
          description: Direct URL to the project (auto-generated)
          example: "https://chatgpt.com/g/g-p-abc123/project"
        first_seen_at:
          type: string
          format: date-time
          description: When the project was first discovered
          example: "2026-01-15T10:00:00Z"
        last_confirmed_at:
          type: string
          format: date-time
          description: When the project was last confirmed to exist
          example: "2026-01-15T16:00:00Z"
        pinned:
          type: boolean
          description: Whether the project is marked for touch operations
          example: false
        pinned_at:
          type: string
          format: date-time
          nullable: true
          description: When the project was pinned (if pinned)
          example: null
        icon_color:
          type: string
          nullable: true
          description: Icon color hex (for touch restore)
          example: "#ff66ad"
        icon_emoji:
          type: string
          nullable: true
          description: Icon emoji name
          example: "graduation-cap"
      required:
        - id
        - title
        - first_seen_at
        - last_confirmed_at

    ProjectSimplified:
      type: object
      description: Simplified project for quick lookups
      properties:
        id:
          type: string
          description: Project identifier
          example: "g-p-abc123"
        name:
          type: string
          description: Project title
          example: "My Awesome Project"
        open_url:
          type: string
          format: uri
          description: Direct URL to open the project
          example: "https://chatgpt.com/g/g-p-abc123/project"
      required:
        - id
        - name
        - open_url

    TouchRequest:
      type: object
      description: A touch queue request
      properties:
        id:
          type: integer
          description: Request ID
          example: 1
        project_id:
          type: string
          description: ID of the project to touch
          example: "g-p-abc123"
        status:
          type: string
          enum:
            - pending
            - processing
            - completed
            - failed
          description: |
            Request status:
            - `pending`: Waiting to be processed
            - `processing`: Currently being touched
            - `completed`: Successfully touched
            - `failed`: Touch operation failed
          example: "pending"
        error_message:
          type: string
          nullable: true
          description: Error details if status is failed
          example: null
        created_at:
          type: string
          format: date-time
          description: When the request was created
          example: "2026-01-15T16:30:00Z"
        processed_at:
          type: string
          format: date-time
          nullable: true
          description: When the request was processed
          example: null
        created_by:
          type: string
          description: Source of the request
          example: "api"
      required:
        - id
        - project_id
        - status
        - created_at

    Meta:
      type: object
      description: Index metadata
      properties:
        name:
          type: string
          description: Index name
          example: "ChatGPT Project Index"
        version:
          type: string
          description: API version
          example: "1.0.0"
        project_count:
          type: integer
          description: Total number of indexed projects
          example: 473
      required:
        - name
        - version
        - project_count

    Error:
      type: object
      description: Error response
      properties:
        message:
          type: string
          description: Error message
          example: "Invalid request body"
        code:
          type: string
          description: Error code
          example: "PGRST102"
        details:
          type: string
          nullable: true
          description: Additional error details
          example: null
        hint:
          type: string
          nullable: true
          description: Hint for resolving the error
          example: null

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            message: "Invalid API key"
            code: "PGRST301"
            details: null
            hint: "Provide a valid apikey header"

  securitySchemes:
    apiKey:
      type: apiKey
      in: header
      name: apikey
      description: Supabase anon key

security:
  - apiKey: []
